<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- T칤tulo actualizado -->
    <title>Preparar Env칤o de Libros Aprobados</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <!-- T칤tulo actualizado -->
        <h1>Preparar Env칤o de Lote de Libros</h1>
        <p>Selecciona los libros aprobados que deseas incluir en el env칤o y elige el destino.</p>

        <!-- Mensajes Flash y Error -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                 <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash-message flash-{{ category }}">{{ message }}</div>
                    {% endfor %}
                 </div>
            {% endif %}
        {% endwith %}
        {% if error_message %}
            <p class="error-msg">Error al cargar: {{ error_message }}</p>
        {% endif %}

        {# === INICIO DEL FORMULARIO QUE ENVUELVE TODO === #}
        {# Apuntar치 a una nueva ruta POST que crearemos: 'create_batch_shipment' #}
        <form action="{{ url_for('books.create_batch_shipment') }}" method="POST">

            <!-- Tabla de Libros Aprobados (Pendientes de Log칤stica) -->
            {% if books %}
                <table class="table-standard">
                    <thead>
                        <tr>
                            {# 1. NUEVA COLUMNA PARA CHECKBOX #}
                            <th style="width: 30px; text-align: center;">Sel.</th>
                            <th>ID</th>
                            <th>T칤tulo</th>
                            <th>ISBN</th>
                            <th>Notas</th>
                            {# Quitamos la columna de acciones individuales que ten칤amos antes #}
                        </tr>
                    </thead>
                    <tbody>
                        {% for book in books %}
                        <tr>
                             {# 1. CELDA CON EL CHECKBOX #}
                             <td style="text-align: center;">
                                 {# El 'name' es importante para recoger la lista en Flask #}
                                 {# El 'value' ser치 el ID del libro #}
                                 <input type="checkbox" name="selected_book_ids" value="{{ book.id }}">
                             </td>
                             <td>{{ book.id }}</td>
                             <td>{{ book.name }}</td>
                             <td>{{ book.default_code if book.default_code else '-' }}</td>
                             <td>{{ book.description if book.description else '-' }}</td>
                             {# Ya no hay bot칩n "Listo para Env칤o" aqu칤 #}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                <hr>

                {# 2. SELECTOR DE DESTINO (FUERA DE LA TABLA, DENTRO DEL FORM) #}
                <div class="form-group" style="margin-top: 20px;">
                    <label for="destination_location_id"><strong>Destino del Env칤o:</strong></label>
                    <select name="destination_location_id" id="destination_location_id" required>
                        <option value="">-- Selecciona una sucursal --</option>
                        {# Pasaremos los IDs de las ubicaciones destino desde Flask en el futuro, #}
                        {# pero por AHORA ponemos los valores directamente aqu칤. 춰RECUERDA PASARLOS DESDE PYTHON LUEGO! #}
                        <option value="29">EC - Quito</option>
                        <option value="34">VEN - Canaima Amazonas</option>
                        <option value="35">VEN - Andes (Tachira)</option>
                        <option value="32">Sucursal Ginebra (Suiza)</option> {# A침adimos Ginebra como opci칩n #}
                        {# A침adir m치s opciones si hay m치s destinos #}
                    </select>
                </div>

                {# 3. BOT칍N PARA CREAR EL ENV칈O DEL LOTE #}
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">游닍 Crear Env칤o de Lote Seleccionado</button>
                </div>

            {% elif not error_message %}
                 <p class="no-items">No hay libros aprobados pendientes de preparar para env칤o.</p>
            {% endif %}

            {# Bot칩n volver fuera del if/else, pero dentro del form por si acaso se necesita #}
            <div class="form-actions" style="text-align: left; border-top: none; margin-top: 10px;">
                 <a href="{{ url_for('main.index') }}" class="btn">Volver a Inicio</a>
             </div>

        </form> {# === FIN DEL FORMULARIO === #}

    </div>
</body>
</html>